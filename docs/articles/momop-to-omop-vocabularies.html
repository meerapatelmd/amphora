<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>mOMOP to OMOP Vocabularies • amphora</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="mOMOP to OMOP Vocabularies">
<meta property="og:description" content="amphora">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">amphora</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/momop-to-omop-vocabularies.html">mOMOP to OMOP Vocabularies</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/meerapatelmd/amphora/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="momop-to-omop-vocabularies_files/htmlwidgets-1.5.3/htmlwidgets.js"></script><script src="momop-to-omop-vocabularies_files/jquery-1.12.4/jquery.min.js"></script><link href="momop-to-omop-vocabularies_files/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="momop-to-omop-vocabularies_files/datatables-binding-0.16/datatables.js"></script><link href="momop-to-omop-vocabularies_files/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="momop-to-omop-vocabularies_files/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="momop-to-omop-vocabularies_files/dt-core-1.10.20/js/jquery.dataTables.min.js"></script><script src="momop-to-omop-vocabularies_files/jszip-1.10.20/jszip.min.js"></script><script src="momop-to-omop-vocabularies_files/pdfmake-1.10.20/pdfmake.js"></script><script src="momop-to-omop-vocabularies_files/pdfmake-1.10.20/vfs_fonts.js"></script><link href="momop-to-omop-vocabularies_files/dt-ext-buttons-1.10.20/css/buttons.dataTables.min.css" rel="stylesheet">
<script src="momop-to-omop-vocabularies_files/dt-ext-buttons-1.10.20/js/dataTables.buttons.min.js"></script><script src="momop-to-omop-vocabularies_files/dt-ext-buttons-1.10.20/js/buttons.flash.min.js"></script><script src="momop-to-omop-vocabularies_files/dt-ext-buttons-1.10.20/js/buttons.html5.min.js"></script><script src="momop-to-omop-vocabularies_files/dt-ext-buttons-1.10.20/js/buttons.colVis.min.js"></script><script src="momop-to-omop-vocabularies_files/dt-ext-buttons-1.10.20/js/buttons.print.min.js"></script><link href="momop-to-omop-vocabularies_files/crosstalk-1.1.0.1/css/crosstalk.css" rel="stylesheet">
<script src="momop-to-omop-vocabularies_files/crosstalk-1.1.0.1/js/crosstalk.min.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>mOMOP to OMOP Vocabularies</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/meerapatelmd/amphora/blob/master/vignettes/momop-to-omop-vocabularies.Rmd"><code>vignettes/momop-to-omop-vocabularies.Rmd</code></a></small>
      <div class="hidden name"><code>momop-to-omop-vocabularies.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/meerapatelmd/amphora">amphora</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/meerapatelmd/mOMOP">mOMOP</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>
<span class="co">#&gt; ── Attaching packages ─────────────────────────────────────── tidyverse 1.3.0 ──</span>
<span class="co">#&gt; ✓ ggplot2 3.3.3     ✓ purrr   0.3.4</span>
<span class="co">#&gt; ✓ tibble  3.0.4     ✓ dplyr   1.0.2</span>
<span class="co">#&gt; ✓ tidyr   1.1.2     ✓ stringr 1.4.0</span>
<span class="co">#&gt; ✓ readr   1.4.0     ✓ forcats 0.5.0</span>
<span class="co">#&gt; ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──</span>
<span class="co">#&gt; x dplyr::filter() masks stats::filter()</span>
<span class="co">#&gt; x dplyr::lag()    masks stats::lag()</span></code></pre></div>
<p>In lieu of using Protege, mCode value set classification developed in the mOMOP package is converted to the OMOP Vocabulary structure, specifically the class hierarchy seen in the Concept Relationship table. This is achieved by creating:<br>
1. Forward “Subsumes” relationships between the <code>class</code> and <code>concept</code>.<br>
1. Inverse “Is a” relationships between the <code>concept</code> and class.<br>
1. Concepts for each <code>class</code> in a Concept table.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">MCODE_CLASS_HIERARCHY</span>
<span class="co">#&gt; # A tibble: 215,271 x 2</span>
<span class="co">#&gt;    class             concept                                                    </span>
<span class="co">#&gt;    &lt;chr&gt;             &lt;chr&gt;                                                      </span>
<span class="co">#&gt;  1 CANCER_BODY_LOCA… [V] [S] 4048384 Body structure [SNOMED 123037004] [Spec An…</span>
<span class="co">#&gt;  2 CANCER_BODY_LOCA… [V] [S] 4002852 Buccal embrasure [SNOMED 110326006] [Spec …</span>
<span class="co">#&gt;  3 CANCER_BODY_LOCA… [V] [S] 36717763 Skin structure of left lower eyelid [SNOM…</span>
<span class="co">#&gt;  4 CANCER_BODY_LOCA… [V] [S] 4230944 Adenofibrosis [SNOMED 89115006] [Observati…</span>
<span class="co">#&gt;  5 CANCER_BODY_LOCA… [V] [S] 42605189 Intervertebral foramen of eighteenth thor…</span>
<span class="co">#&gt;  6 CANCER_BODY_LOCA… [V] [S] 4097829 Transitional cell carcinoma [SNOMED 270900…</span>
<span class="co">#&gt;  7 CANCER_BODY_LOCA… [V] [S] 4265989 Structure of medial nuclei of hypothalamus…</span>
<span class="co">#&gt;  8 CANCER_BODY_LOCA… [V] [S] 4143459 Structure of subarachnoid space of brain […</span>
<span class="co">#&gt;  9 CANCER_BODY_LOCA… [V] [S] 4093877 Entire body of second thoracic vertebra [S…</span>
<span class="co">#&gt; 10 CANCER_BODY_LOCA… [V] [S] 4300995 Structure of suprarenal vein [SNOMED 77905…</span>
<span class="co">#&gt; # … with 215,261 more rows</span></code></pre></div>
<p>The <code>class</code> field is converted into a human readable format.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">MCODE_CLASS_HIERARCHY2</span> <span class="op">&lt;-</span>
  <span class="va">MCODE_CLASS_HIERARCHY</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate_at</span><span class="op">(</span><span class="fu">vars</span><span class="op">(</span><span class="va">class</span><span class="op">)</span>, <span class="fu">stringr</span><span class="fu">::</span><span class="va"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace_all</a></span>, <span class="st">"_"</span>, <span class="st">" "</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate_at</span><span class="op">(</span><span class="fu">vars</span><span class="op">(</span><span class="va">class</span><span class="op">)</span>, <span class="fu">stringr</span><span class="fu">::</span><span class="va"><a href="https://stringr.tidyverse.org/reference/case.html">str_to_title</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">MCODE_CLASS_HIERARCHY2</span><span class="op">$</span><span class="va">class</span><span class="op">)</span>
<span class="co">#&gt;  [1] "Cancer Body Location"            "Cancer Disease Status Evidence "</span>
<span class="co">#&gt;  [3] "Cancer Disorder"                 "Cancer Related Surgical Procedu"</span>
<span class="co">#&gt;  [5] "Cancer Staging"                  "Cancer Staging System"          </span>
<span class="co">#&gt;  [7] "Comorbid Condition"              "Condition Status Trend"         </span>
<span class="co">#&gt;  [9] "Genomics"                        "Histology Morphology Behavior"  </span>
<span class="co">#&gt; [11] "Laterality"                      "Primary Or Uncertain Behavior C"</span>
<span class="co">#&gt; [13] "Radiation Procedure"             "Radiation Target Body Site"     </span>
<span class="co">#&gt; [15] "Secondary Cancer Disorder"       "Specimen"                       </span>
<span class="co">#&gt; [17] "Treatment Intent"                "Treatment Termination Reason"   </span>
<span class="co">#&gt; [19] "Tumor Marker Measurement"        "Units Of Measurement"           </span>
<span class="co">#&gt; [21] "Yes No Unknown"</span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">CONCEPT_A</span> <span class="op">&lt;-</span>
  <span class="va">MCODE_CLASS_HIERARCHY2</span> <span class="op">%&gt;%</span>
  <span class="fu">select</span><span class="op">(</span><span class="va">class</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">distinct</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>concept_id <span class="op">=</span> <span class="fu">uuid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/uuid/man/UUIDgenerate.html">UUIDgenerate</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">MCODE_CLASS_HIERARCHY2</span><span class="op">$</span><span class="va">class</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
         concept_code <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">MCODE_CLASS_HIERARCHY2</span><span class="op">$</span><span class="va">class</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">transmute</span><span class="op">(</span>
    <span class="va">concept_id</span>,
    concept_name <span class="op">=</span> <span class="va">class</span>,
    domain_id <span class="op">=</span> <span class="st">"Cancer Modifier"</span>,
    vocabulary_id <span class="op">=</span> <span class="st">"mOMOP"</span>,
    concept_class_id <span class="op">=</span> <span class="st">"Class"</span>,
    standard_concept <span class="op">=</span> <span class="st">"C"</span>,
    <span class="va">concept_code</span>,
    valid_start_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.Date</a></span><span class="op">(</span><span class="op">)</span>,
    valid_end_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="cn">NA_character_</span><span class="op">)</span>,
    invalid_reason <span class="op">=</span> <span class="cn">NA_character_</span><span class="op">)</span>
<span class="fu">rMarkedDown</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rMarkedDown/man/print_dt.html">print_dt</a></span><span class="op">(</span><span class="va">CONCEPT_A</span><span class="op">)</span></code></pre></div>
<div id="htmlwidget-1bdbdc1b67dbadd643d9" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-1bdbdc1b67dbadd643d9">{"x":{"filter":"none","extensions":["Buttons"],"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21"],["560c3912-1303-4075-82a5-9384f096723a","31a11570-e700-4f23-80bc-4e993f6fd07c","a53dd052-378e-4b66-9fb0-258858a74881","522dd798-1e7a-449d-a1e3-116ef5d71912","a4c1d18c-39fc-43b0-8ad9-ad1d45a1d274","bb9063e9-db28-4387-af50-d91aab206dad","92cf37ca-8704-4114-9b9c-be50d743c5e0","f8dca9e7-b0dd-4a95-969e-b7a6a79ae9fe","016429fd-9a98-4062-919e-3dd235b59d99","c2fcfac6-b1e1-4dc6-bc04-97ac9d6c6914","e1c5a327-9f09-4fb1-afe9-1b481a3e9347","df22a86d-6b7a-44c1-a909-524e02c92a43","0a0b8d8f-5bc0-4c75-9645-2dd0d9046e97","eaf50a1c-ab80-4ddb-818f-18928f043f49","4549c666-8fbd-42e2-a2f9-aaff96afeec0","81ddba40-4808-480a-81cb-73e4350b1df2","01496bbe-2763-4122-860c-955df801ff1b","729328a1-92a3-494e-a148-561a175dc7d3","16c0d236-e268-48e3-9db6-0b836fa401e8","bc9f5f2d-41be-480a-8775-890e82e255a3","fadb346c-3e85-41e0-94c8-fcc5624c128c"],["Cancer Body Location","Cancer Disease Status Evidence ","Cancer Disorder","Cancer Related Surgical Procedu","Cancer Staging","Cancer Staging System","Comorbid Condition","Condition Status Trend","Genomics","Histology Morphology Behavior","Laterality","Primary Or Uncertain Behavior C","Radiation Procedure","Radiation Target Body Site","Secondary Cancer Disorder","Specimen","Treatment Intent","Treatment Termination Reason","Tumor Marker Measurement","Units Of Measurement","Yes No Unknown"],["Cancer Modifier","Cancer Modifier","Cancer Modifier","Cancer Modifier","Cancer Modifier","Cancer Modifier","Cancer Modifier","Cancer Modifier","Cancer Modifier","Cancer Modifier","Cancer Modifier","Cancer Modifier","Cancer Modifier","Cancer Modifier","Cancer Modifier","Cancer Modifier","Cancer Modifier","Cancer Modifier","Cancer Modifier","Cancer Modifier","Cancer Modifier"],["mOMOP","mOMOP","mOMOP","mOMOP","mOMOP","mOMOP","mOMOP","mOMOP","mOMOP","mOMOP","mOMOP","mOMOP","mOMOP","mOMOP","mOMOP","mOMOP","mOMOP","mOMOP","mOMOP","mOMOP","mOMOP"],["Class","Class","Class","Class","Class","Class","Class","Class","Class","Class","Class","Class","Class","Class","Class","Class","Class","Class","Class","Class","Class"],["C","C","C","C","C","C","C","C","C","C","C","C","C","C","C","C","C","C","C","C","C"],[21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21],["2021-01-05","2021-01-05","2021-01-05","2021-01-05","2021-01-05","2021-01-05","2021-01-05","2021-01-05","2021-01-05","2021-01-05","2021-01-05","2021-01-05","2021-01-05","2021-01-05","2021-01-05","2021-01-05","2021-01-05","2021-01-05","2021-01-05","2021-01-05","2021-01-05"],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>concept_id<\/th>\n      <th>concept_name<\/th>\n      <th>domain_id<\/th>\n      <th>vocabulary_id<\/th>\n      <th>concept_class_id<\/th>\n      <th>standard_concept<\/th>\n      <th>concept_code<\/th>\n      <th>valid_start_date<\/th>\n      <th>valid_end_date<\/th>\n      <th>invalid_reason<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"Blfrtip","buttons":["copy","csv","excel","pdf","print"],"lengthMenu":[[10,25,50,-1],["10","25","50","All"]],"columnDefs":[{"className":"dt-right","targets":7},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script><div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">CONCEPT_RELATIONSHIP</span> <span class="op">&lt;-</span>
<span class="va">CONCEPT_A</span> <span class="op">%&gt;%</span>
  <span class="fu">transmute</span><span class="op">(</span>concept_id_1 <span class="op">=</span> <span class="va">concept_id</span>,
            class <span class="op">=</span> <span class="va">concept_name</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">inner_join</span><span class="op">(</span><span class="va">MCODE_CLASS_HIERARCHY2</span>,
            by <span class="op">=</span> <span class="st">"class"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">chariot</span><span class="fu">::</span><span class="fu"><a href="https://meerapatelmd.github.io/chariot/reference/unmerge_strip.html">unmerge_strip</a></span><span class="op">(</span>strip_col <span class="op">=</span> <span class="va">concept</span>,
                         remove <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>concept_id_2 <span class="op">=</span> <span class="fu">coalesce</span><span class="op">(</span><span class="va">concept_id</span>, <span class="va">concept</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">transmute</span><span class="op">(</span><span class="va">concept_id_1</span>,
             relationship_id <span class="op">=</span> <span class="st">"Is a"</span>,
             <span class="va">concept_id_2</span>,
             valid_start_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.Date</a></span><span class="op">(</span><span class="op">)</span>,
             valid_end_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="cn">NA_character_</span><span class="op">)</span>,
             invalid_reason <span class="op">=</span> <span class="cn">NA_character_</span><span class="op">)</span>
<span class="co">#&gt; Warning in chariot::unmerge_strip(., strip_col = concept, remove = FALSE): Not</span>
<span class="co">#&gt; all concepts unmerged: 24. See flagUnmergeStrip object.</span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">CONCEPT_B</span> <span class="op">&lt;-</span>
<span class="fu">chariot</span><span class="fu">::</span><span class="fu"><a href="https://meerapatelmd.github.io/chariot/reference/join_on_concept_id.html">join_on_concept_id</a></span><span class="op">(</span>
  data <span class="op">=</span> <span class="va">CONCEPT_RELATIONSHIP</span> <span class="op">%&gt;%</span>
            <span class="fu">mutate_at</span><span class="op">(</span><span class="fu">vars</span><span class="op">(</span><span class="va">concept_id_2</span><span class="op">)</span>, <span class="va">as.integer</span><span class="op">)</span>,
  column <span class="op">=</span> <span class="st">"concept_id_2"</span>
<span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">select</span><span class="op">(</span><span class="va">concept_id</span><span class="op">:</span><span class="fu">last_col</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [2021-01-05 00:47:43]    Target column: concept_id_2</span>
<span class="co">#&gt; Connecting using PostgreSQL driver</span>
<span class="co">#&gt; [2021-01-05 00:47:43]    Dropping patelm9.V20210105004743...</span>
<span class="co">#&gt; [2021-01-05 00:47:43]    </span>
<span class="co">#&gt; ✓ Open connection</span>
<span class="co">#&gt; [2021-01-05 00:47:43]    </span>
<span class="co">#&gt; ✓ JDBC connection</span>
<span class="co">#&gt; [2021-01-05 00:47:43]    SQL: DROP TABLE IF EXISTS patelm9.V20210105004743;</span>
<span class="co">#&gt; [2021-01-05 00:47:43]    Sending...</span>
<span class="co">#&gt; [2021-01-05 00:47:43]    Sending...complete</span>
<span class="co">#&gt; [2021-01-05 00:47:43]    Dropping patelm9.V20210105004743...complete</span>
<span class="co">#&gt; Warning: Problem with `mutate()` input `concept_id_2`.</span>
<span class="co">#&gt; ℹ NAs introduced by coercion</span>
<span class="co">#&gt; ℹ Input `concept_id_2` is `.Primitive("as.integer")(concept_id_2)`.</span>
<span class="co">#&gt; Warning in mask$eval_all_mutate(dots[[i]]): NAs introduced by coercion</span>
<span class="co">#&gt; [2021-01-05 00:47:43]    </span>
<span class="co">#&gt; ✓ Data 'data' has more than 0 rows</span>
<span class="co">#&gt; [2021-01-05 00:47:43]    </span>
<span class="co">#&gt; ✓ Table name 'V20210105004743' is not a reserved word</span>
<span class="co">#&gt; [2021-01-05 00:47:43]    </span>
<span class="co">#&gt; ✓ Field name 'concept_id_1' is not a reserved word</span>
<span class="co">#&gt; [2021-01-05 00:47:43]    </span>
<span class="co">#&gt; ✓ Field name 'relationship_id' is not a reserved word</span>
<span class="co">#&gt; [2021-01-05 00:47:43]    </span>
<span class="co">#&gt; ✓ Field name 'concept_id_2' is not a reserved word</span>
<span class="co">#&gt; [2021-01-05 00:47:43]    </span>
<span class="co">#&gt; ✓ Field name 'valid_start_date' is not a reserved word</span>
<span class="co">#&gt; [2021-01-05 00:47:43]    </span>
<span class="co">#&gt; ✓ Field name 'valid_end_date' is not a reserved word</span>
<span class="co">#&gt; [2021-01-05 00:47:43]    </span>
<span class="co">#&gt; ✓ Field name 'invalid_reason' is not a reserved word</span>
<span class="co">#&gt; [2021-01-05 00:47:43]    Writing patelm9.V20210105004743...</span>
<span class="co">#&gt; Warning in max(nchar(as.character(obj)), na.rm = TRUE): no non-missing arguments</span>
<span class="co">#&gt; to max; returning -Inf</span>
<span class="co">#&gt; [2021-01-05 00:47:49]    Writing patelm9.V20210105004743...complete</span>
<span class="co">#&gt; [2021-01-05 00:47:49]    </span>
<span class="co">#&gt; ✓ Open connection</span>
<span class="co">#&gt; [2021-01-05 00:47:49]    </span>
<span class="co">#&gt; ✓ JDBC connection</span>
<span class="co">#&gt; [2021-01-05 00:47:49]    SQL: SELECT a.*, b.* FROM patelm9.V20210105004743 a LEFT JOIN omop_vocabulary.concept b ON a.concept_id_2 = b.concept_id WHERE b.invalid_reason IS NULL</span>
<span class="co">#&gt; [2021-01-05 00:47:49]    Querying...</span>
<span class="co">#&gt; [2021-01-05 00:47:56]    Querying...complete</span>
<span class="co">#&gt; [2021-01-05 00:47:56]    </span>
<span class="co">#&gt; ✓ Returned data has more than 0 rows</span>
<span class="co">#&gt; [2021-01-05 00:47:56]    Dropping patelm9.V20210105004743...</span>
<span class="co">#&gt; [2021-01-05 00:47:56]    </span>
<span class="co">#&gt; ✓ Open connection</span>
<span class="co">#&gt; [2021-01-05 00:47:56]    </span>
<span class="co">#&gt; ✓ JDBC connection</span>
<span class="co">#&gt; [2021-01-05 00:47:56]    SQL: DROP TABLE IF EXISTS patelm9.V20210105004743;</span>
<span class="co">#&gt; [2021-01-05 00:47:56]    Sending...</span>
<span class="co">#&gt; [2021-01-05 00:47:56]    Sending...complete</span>
<span class="co">#&gt; [2021-01-05 00:47:56]    Dropping patelm9.V20210105004743...complete</span>
<span class="co">#&gt; [2021-01-05 00:47:56]    Postgres connection to 'athena' closed</span></code></pre></div>
<p>Both subsets of the Concept data, including <code>concept_id</code> is converted to character because the <code>uuid</code> identifiers created are not integers.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">CONCEPT</span> <span class="op">&lt;-</span>
  <span class="fu">bind_rows</span><span class="op">(</span><span class="va">CONCEPT_A</span> <span class="op">%&gt;%</span>
              <span class="fu">mutate_all</span><span class="op">(</span><span class="va">as.character</span><span class="op">)</span>,
            <span class="va">CONCEPT_B</span> <span class="op">%&gt;%</span>
              <span class="fu">mutate_all</span><span class="op">(</span><span class="va">as.character</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>The dataset is written to data-raw/ if it does not already exist.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">MOMOP_TABLES</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>CONCEPT <span class="op">=</span> <span class="va">CONCEPT</span>,
       CONCEPT_RELATIONSHIP <span class="op">=</span> <span class="va">CONCEPT_RELATIONSHIP</span><span class="op">)</span> 

<span class="va">file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="st">"data-raw"</span>, <span class="st">"MOMOP_TABLES.xlsx"</span><span class="op">)</span>
<span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html">file.exists</a></span><span class="op">(</span><span class="va">file</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu">broca</span><span class="fu">::</span><span class="fu"><a href="https://meerapatelmd.github.io/broca/reference/write_full_excel.html">write_full_excel</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">MOMOP_TABLES</span>,
                          file <span class="op">=</span> <span class="va">file</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Meera Patel, MD.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
